		     \||||||||||||||||||/
		   --- Welcome to Maude ---
		     /||||||||||||||||||\
	    Maude 3.2.1 built: Feb 21 2022 18:21:17
	     Copyright 1997-2022 SRI International
		   Thu Aug  3 14:12:30 2023
==========================================
erewrite in LANG-IO : executeFile("test.lang") .
rewrites: 191 in 10ms cpu (12ms real) (19100 rewrites/second)
result EvalResult: {void,[func("read",params(empty),$lock(id("res"), stdio) ;
    return(id("res"))) ; func("write",params(id("s")),$dispatch(id("s"),
    stdio)) | "a" := 0 | stack(1, 0 |-> intVal(0))]}
==========================================
erewrite in COMPOSITION : initComposition simulateAndPrint(composition,
    composition) parseTermFromFile(composition, composition, "cache.spec") .
<>
connectionManager(8)
initManager(2)
service "backend" {
	code {...}
	routes {...}
	process for CONN : 5 | "/add-favorite" ~ map("user" |-> map(("id" |->
    intVal(0), "type" |-> strVal("user")))) : [ 		< executor :
    Executor | currentResult : evalStmt(call("respond", args(str("ok"))),
    getState(functionCallResult(params(id("svc"), id("path"), id("payload")),[
    func("addFavorite", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("guest_id"), member(id(
    "user"), "session"))))) ; assign(id("response"), call("request", args(str(
    "db"), str("get-favorites"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("field"), str("guest_id")), dictItem(id("value"), member(id(
    "user"), "session")))))) ; call("request", args(str("cache"), str("set"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))), dictItem(id("value"), call("len", args(id("response"))))))),
    $ifelse($eq(member(id("user"), "type"), str("user")), call("request", args(
    str("db"), str("insert-favorite"), dict(dictItem(id("type"), str("user")),
    dictItem(id("user_id"), member(id("user"), "id"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("user")), dictItem(id("field"), str("user_id")),
    dictItem(id("value"), member(id("user"), "id")))))) ; call("request", args(
    str("cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))), dictItem(id("value"), call("len", args(id(
    "response"))))))), pass)) ; call("respond", args(str("ok")))) ; func(
    "getFavoriteCount", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), assign(id("r"), call("request", args(str("cache"), str("get"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(member(id(
    "user"), "type"), str("user")), assign(id("r"), call("request", args(str(
    "cache"), str("get"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))))))) ; call("respond", args(id("r"))), pass)) ;
    call("respond", args(str("ok")))) ; func("getPersistent", params(id(
    "key")), $dispatch(id("key"), getPersistentValue) ; $lock(id("res"),
    getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "request" := 3 ; "response" := 37 ; "user" := 6 |
    stack(38, 0 |-> intVal(0) ; 1 |-> strVal("user") ; 2 |-> dictVal(d("id", 0)
    ; d("type", 1)) ; 3 |-> dictVal(d("user", 2)) ; 4 |-> intVal(0) ; 5 |->
    strVal("user") ; 6 |-> dictVal(d("id", 4) ; d("type", 5)) ; 7 |-> strVal(
    "db") ; 8 |-> strVal("insert-favorite") ; 9 |-> strVal("user") ; 10 |->
    intVal(0) ; 11 |-> dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |->
    strVal("db") ; 13 |-> strVal("insert-favorite") ; 14 |-> strVal("user") ;
    15 |-> intVal(0) ; 16 |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17
    |-> strVal("ok") ; 18 |-> strVal("db") ; 19 |-> strVal("get-favorites") ;
    20 |-> strVal("user") ; 21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23
    |-> dictVal(d("field", 21) ; d("type", 20) ; d("value", 22)) ; 24 |->
    strVal("db") ; 25 |-> strVal("get-favorites") ; 26 |-> strVal("user_id") ;
    27 |-> strVal("user") ; 28 |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ;
    d("type", 27) ; d("value", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(
    "user") ; 32 |-> intVal(0) ; 33 |-> dictVal(d("type", 31) ; d("user_id",
    32)) ; 34 |-> strVal("user") ; 35 |-> intVal(0) ; 36 |-> dictVal(d("type",
    34) ; d("user_id", 35)) ; 37 |-> listVal(36))], evalStmt($dispatch(list(id(
    "svc"), id("path"), id("payload")), connectionOut) ; $lock(id("res"),
    connectionOut) ; return(id("res")),[func("addFavorite", params(id(
    "request")), assign(id("user"), member(id("request"), "user")) ; $ifelse(
    $eq(member(id("user"), "type"), str("guest")), call("request", args(str(
    "db"), str("insert-favorite"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("guest_id"), member(id("user"), "session"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("field"), str("guest_id")),
    dictItem(id("value"), member(id("user"), "session")))))) ; call("request",
    args(str("cache"), str("set"), dict(dictItem(id("key"), $add(str(
    "fav:guest:"), member(id("user"), "session"))), dictItem(id("value"), call(
    "len", args(id("response"))))))), $ifelse($eq(member(id("user"), "type"),
    str("user")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("user")), dictItem(id("user_id"), member(id(
    "user"), "id"))))) ; assign(id("response"), call("request", args(str("db"),
    str("get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | getVars(addArgs(args(empty), params(empty),
    assignVar("payload", getValue({dictVal(getDict(getValue(evalExpr(dict(
    dictItem(id("value"), call("len", args(id("response"))))),[func(
    "addFavorite", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("guest_id"), member(id(
    "user"), "session"))))) ; assign(id("response"), call("request", args(str(
    "db"), str("get-favorites"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("field"), str("guest_id")), dictItem(id("value"), member(id(
    "user"), "session")))))) ; call("request", args(str("cache"), str("set"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))), dictItem(id("value"), call("len", args(id("response"))))))),
    $ifelse($eq(member(id("user"), "type"), str("user")), call("request", args(
    str("db"), str("insert-favorite"), dict(dictItem(id("type"), str("user")),
    dictItem(id("user_id"), member(id("user"), "id"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("user")), dictItem(id("field"), str("user_id")),
    dictItem(id("value"), member(id("user"), "id")))))) ; call("request", args(
    str("cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))), dictItem(id("value"), call("len", args(id(
    "response"))))))), pass)) ; call("respond", args(str("ok")))) ; func(
    "getFavoriteCount", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), assign(id("r"), call("request", args(str("cache"), str("get"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(member(id(
    "user"), "type"), str("user")), assign(id("r"), call("request", args(str(
    "cache"), str("get"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))))))) ; call("respond", args(id("r"))), pass)) ;
    call("respond", args(str("ok")))) ; func("getPersistent", params(id(
    "key")), $dispatch(id("key"), getPersistentValue) ; $lock(id("res"),
    getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | pushStack(getValue(evalExpr($add(str(
    "fav:user:"), member(id("user"), "id")),[func("addFavorite", params(id(
    "request")), assign(id("user"), member(id("request"), "user")) ; $ifelse(
    $eq(member(id("user"), "type"), str("guest")), call("request", args(str(
    "db"), str("insert-favorite"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("guest_id"), member(id("user"), "session"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("field"), str("guest_id")),
    dictItem(id("value"), member(id("user"), "session")))))) ; call("request",
    args(str("cache"), str("set"), dict(dictItem(id("key"), $add(str(
    "fav:guest:"), member(id("user"), "session"))), dictItem(id("value"), call(
    "len", args(id("response"))))))), $ifelse($eq(member(id("user"), "type"),
    str("user")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("user")), dictItem(id("user_id"), member(id(
    "user"), "id"))))) ; assign(id("response"), call("request", args(str("db"),
    str("get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal("set"))])), getStack(
    getState(evalExpr($add(str("fav:user:"), member(id("user"), "id")),[func(
    "addFavorite", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("guest_id"), member(id(
    "user"), "session"))))) ; assign(id("response"), call("request", args(str(
    "db"), str("get-favorites"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("field"), str("guest_id")), dictItem(id("value"), member(id(
    "user"), "session")))))) ; call("request", args(str("cache"), str("set"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))), dictItem(id("value"), call("len", args(id("response"))))))),
    $ifelse($eq(member(id("user"), "type"), str("user")), call("request", args(
    str("db"), str("insert-favorite"), dict(dictItem(id("type"), str("user")),
    dictItem(id("user_id"), member(id("user"), "id"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("user")), dictItem(id("field"), str("user_id")),
    dictItem(id("value"), member(id("user"), "id")))))) ; call("request", args(
    str("cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))), dictItem(id("value"), call("len", args(id(
    "response"))))))), pass)) ; call("respond", args(str("ok")))) ; func(
    "getFavoriteCount", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), assign(id("r"), call("request", args(str("cache"), str("get"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(member(id(
    "user"), "type"), str("user")), assign(id("r"), call("request", args(str(
    "cache"), str("get"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))))))) ; call("respond", args(id("r"))), pass)) ;
    call("respond", args(str("ok")))) ; func("getPersistent", params(id(
    "key")), $dispatch(id("key"), getPersistentValue) ; $lock(id("res"),
    getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal("set"))]))))]))) ; d(
    "key", lastIndex(getStack(getState(evalExpr($add(str("fav:user:"), member(
    id("user"), "id")),[func("addFavorite", params(id("request")), assign(id(
    "user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), call("request", args(str("db"), str(
    "insert-favorite"), dict(dictItem(id("type"), str("guest")), dictItem(id(
    "guest_id"), member(id("user"), "session"))))) ; assign(id("response"),
    call("request", args(str("db"), str("get-favorites"), dict(dictItem(id(
    "type"), str("guest")), dictItem(id("field"), str("guest_id")), dictItem(
    id("value"), member(id("user"), "session")))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:guest:"),
    member(id("user"), "session"))), dictItem(id("value"), call("len", args(id(
    "response"))))))), $ifelse($eq(member(id("user"), "type"), str("user")),
    call("request", args(str("db"), str("insert-favorite"), dict(dictItem(id(
    "type"), str("user")), dictItem(id("user_id"), member(id("user"), "id")))))
    ; assign(id("response"), call("request", args(str("db"), str(
    "get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal("set"))])))))),
    getState(evalExpr(dict(dictItem(id("value"), call("len", args(id(
    "response"))))),[func("addFavorite", params(id("request")), assign(id(
    "user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), call("request", args(str("db"), str(
    "insert-favorite"), dict(dictItem(id("type"), str("guest")), dictItem(id(
    "guest_id"), member(id("user"), "session"))))) ; assign(id("response"),
    call("request", args(str("db"), str("get-favorites"), dict(dictItem(id(
    "type"), str("guest")), dictItem(id("field"), str("guest_id")), dictItem(
    id("value"), member(id("user"), "session")))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:guest:"),
    member(id("user"), "session"))), dictItem(id("value"), call("len", args(id(
    "response"))))))), $ifelse($eq(member(id("user"), "type"), str("user")),
    call("request", args(str("db"), str("insert-favorite"), dict(dictItem(id(
    "type"), str("user")), dictItem(id("user_id"), member(id("user"), "id")))))
    ; assign(id("response"), call("request", args(str("db"), str(
    "get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | pushStack(getValue(evalExpr($add(str(
    "fav:user:"), member(id("user"), "id")),[func("addFavorite", params(id(
    "request")), assign(id("user"), member(id("request"), "user")) ; $ifelse(
    $eq(member(id("user"), "type"), str("guest")), call("request", args(str(
    "db"), str("insert-favorite"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("guest_id"), member(id("user"), "session"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("field"), str("guest_id")),
    dictItem(id("value"), member(id("user"), "session")))))) ; call("request",
    args(str("cache"), str("set"), dict(dictItem(id("key"), $add(str(
    "fav:guest:"), member(id("user"), "session"))), dictItem(id("value"), call(
    "len", args(id("response"))))))), $ifelse($eq(member(id("user"), "type"),
    str("user")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("user")), dictItem(id("user_id"), member(id(
    "user"), "id"))))) ; assign(id("response"), call("request", args(str("db"),
    str("get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal("set"))])), getStack(
    getState(evalExpr($add(str("fav:user:"), member(id("user"), "id")),[func(
    "addFavorite", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("guest_id"), member(id(
    "user"), "session"))))) ; assign(id("response"), call("request", args(str(
    "db"), str("get-favorites"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("field"), str("guest_id")), dictItem(id("value"), member(id(
    "user"), "session")))))) ; call("request", args(str("cache"), str("set"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))), dictItem(id("value"), call("len", args(id("response"))))))),
    $ifelse($eq(member(id("user"), "type"), str("user")), call("request", args(
    str("db"), str("insert-favorite"), dict(dictItem(id("type"), str("user")),
    dictItem(id("user_id"), member(id("user"), "id"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("user")), dictItem(id("field"), str("user_id")),
    dictItem(id("value"), member(id("user"), "id")))))) ; call("request", args(
    str("cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))), dictItem(id("value"), call("len", args(id(
    "response"))))))), pass)) ; call("respond", args(str("ok")))) ; func(
    "getFavoriteCount", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), assign(id("r"), call("request", args(str("cache"), str("get"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(member(id(
    "user"), "type"), str("user")), assign(id("r"), call("request", args(str(
    "cache"), str("get"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))))))) ; call("respond", args(id("r"))), pass)) ;
    call("respond", args(str("ok")))) ; func("getPersistent", params(id(
    "key")), $dispatch(id("key"), getPersistentValue) ; $lock(id("res"),
    getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal("set"))]))))]))}),
    getState({dictVal(getDict(getValue(evalExpr(dict(dictItem(id("value"),
    call("len", args(id("response"))))),[func("addFavorite", params(id(
    "request")), assign(id("user"), member(id("request"), "user")) ; $ifelse(
    $eq(member(id("user"), "type"), str("guest")), call("request", args(str(
    "db"), str("insert-favorite"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("guest_id"), member(id("user"), "session"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("field"), str("guest_id")),
    dictItem(id("value"), member(id("user"), "session")))))) ; call("request",
    args(str("cache"), str("set"), dict(dictItem(id("key"), $add(str(
    "fav:guest:"), member(id("user"), "session"))), dictItem(id("value"), call(
    "len", args(id("response"))))))), $ifelse($eq(member(id("user"), "type"),
    str("user")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("user")), dictItem(id("user_id"), member(id(
    "user"), "id"))))) ; assign(id("response"), call("request", args(str("db"),
    str("get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | pushStack(getValue(evalExpr($add(str(
    "fav:user:"), member(id("user"), "id")),[func("addFavorite", params(id(
    "request")), assign(id("user"), member(id("request"), "user")) ; $ifelse(
    $eq(member(id("user"), "type"), str("guest")), call("request", args(str(
    "db"), str("insert-favorite"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("guest_id"), member(id("user"), "session"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("field"), str("guest_id")),
    dictItem(id("value"), member(id("user"), "session")))))) ; call("request",
    args(str("cache"), str("set"), dict(dictItem(id("key"), $add(str(
    "fav:guest:"), member(id("user"), "session"))), dictItem(id("value"), call(
    "len", args(id("response"))))))), $ifelse($eq(member(id("user"), "type"),
    str("user")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("user")), dictItem(id("user_id"), member(id(
    "user"), "id"))))) ; assign(id("response"), call("request", args(str("db"),
    str("get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal("set"))])), getStack(
    getState(evalExpr($add(str("fav:user:"), member(id("user"), "id")),[func(
    "addFavorite", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("guest_id"), member(id(
    "user"), "session"))))) ; assign(id("response"), call("request", args(str(
    "db"), str("get-favorites"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("field"), str("guest_id")), dictItem(id("value"), member(id(
    "user"), "session")))))) ; call("request", args(str("cache"), str("set"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))), dictItem(id("value"), call("len", args(id("response"))))))),
    $ifelse($eq(member(id("user"), "type"), str("user")), call("request", args(
    str("db"), str("insert-favorite"), dict(dictItem(id("type"), str("user")),
    dictItem(id("user_id"), member(id("user"), "id"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("user")), dictItem(id("field"), str("user_id")),
    dictItem(id("value"), member(id("user"), "id")))))) ; call("request", args(
    str("cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))), dictItem(id("value"), call("len", args(id(
    "response"))))))), pass)) ; call("respond", args(str("ok")))) ; func(
    "getFavoriteCount", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), assign(id("r"), call("request", args(str("cache"), str("get"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(member(id(
    "user"), "type"), str("user")), assign(id("r"), call("request", args(str(
    "cache"), str("get"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))))))) ; call("respond", args(id("r"))), pass)) ;
    call("respond", args(str("ok")))) ; func("getPersistent", params(id(
    "key")), $dispatch(id("key"), getPersistentValue) ; $lock(id("res"),
    getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal("set"))]))))]))) ; d(
    "key", lastIndex(getStack(getState(evalExpr($add(str("fav:user:"), member(
    id("user"), "id")),[func("addFavorite", params(id("request")), assign(id(
    "user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), call("request", args(str("db"), str(
    "insert-favorite"), dict(dictItem(id("type"), str("guest")), dictItem(id(
    "guest_id"), member(id("user"), "session"))))) ; assign(id("response"),
    call("request", args(str("db"), str("get-favorites"), dict(dictItem(id(
    "type"), str("guest")), dictItem(id("field"), str("guest_id")), dictItem(
    id("value"), member(id("user"), "session")))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:guest:"),
    member(id("user"), "session"))), dictItem(id("value"), call("len", args(id(
    "response"))))))), $ifelse($eq(member(id("user"), "type"), str("user")),
    call("request", args(str("db"), str("insert-favorite"), dict(dictItem(id(
    "type"), str("user")), dictItem(id("user_id"), member(id("user"), "id")))))
    ; assign(id("response"), call("request", args(str("db"), str(
    "get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal("set"))])))))),
    getState(evalExpr(dict(dictItem(id("value"), call("len", args(id(
    "response"))))),[func("addFavorite", params(id("request")), assign(id(
    "user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), call("request", args(str("db"), str(
    "insert-favorite"), dict(dictItem(id("type"), str("guest")), dictItem(id(
    "guest_id"), member(id("user"), "session"))))) ; assign(id("response"),
    call("request", args(str("db"), str("get-favorites"), dict(dictItem(id(
    "type"), str("guest")), dictItem(id("field"), str("guest_id")), dictItem(
    id("value"), member(id("user"), "session")))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:guest:"),
    member(id("user"), "session"))), dictItem(id("value"), call("len", args(id(
    "response"))))))), $ifelse($eq(member(id("user"), "type"), str("user")),
    call("request", args(str("db"), str("insert-favorite"), dict(dictItem(id(
    "type"), str("user")), dictItem(id("user_id"), member(id("user"), "id")))))
    ; assign(id("response"), call("request", args(str("db"), str(
    "get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | pushStack(getValue(evalExpr($add(str(
    "fav:user:"), member(id("user"), "id")),[func("addFavorite", params(id(
    "request")), assign(id("user"), member(id("request"), "user")) ; $ifelse(
    $eq(member(id("user"), "type"), str("guest")), call("request", args(str(
    "db"), str("insert-favorite"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("guest_id"), member(id("user"), "session"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("field"), str("guest_id")),
    dictItem(id("value"), member(id("user"), "session")))))) ; call("request",
    args(str("cache"), str("set"), dict(dictItem(id("key"), $add(str(
    "fav:guest:"), member(id("user"), "session"))), dictItem(id("value"), call(
    "len", args(id("response"))))))), $ifelse($eq(member(id("user"), "type"),
    str("user")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("user")), dictItem(id("user_id"), member(id(
    "user"), "id"))))) ; assign(id("response"), call("request", args(str("db"),
    str("get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal("set"))])), getStack(
    getState(evalExpr($add(str("fav:user:"), member(id("user"), "id")),[func(
    "addFavorite", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("guest_id"), member(id(
    "user"), "session"))))) ; assign(id("response"), call("request", args(str(
    "db"), str("get-favorites"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("field"), str("guest_id")), dictItem(id("value"), member(id(
    "user"), "session")))))) ; call("request", args(str("cache"), str("set"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))), dictItem(id("value"), call("len", args(id("response"))))))),
    $ifelse($eq(member(id("user"), "type"), str("user")), call("request", args(
    str("db"), str("insert-favorite"), dict(dictItem(id("type"), str("user")),
    dictItem(id("user_id"), member(id("user"), "id"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("user")), dictItem(id("field"), str("user_id")),
    dictItem(id("value"), member(id("user"), "id")))))) ; call("request", args(
    str("cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))), dictItem(id("value"), call("len", args(id(
    "response"))))))), pass)) ; call("respond", args(str("ok")))) ; func(
    "getFavoriteCount", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), assign(id("r"), call("request", args(str("cache"), str("get"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(member(id(
    "user"), "type"), str("user")), assign(id("r"), call("request", args(str(
    "cache"), str("get"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))))))) ; call("respond", args(id("r"))), pass)) ;
    call("respond", args(str("ok")))) ; func("getPersistent", params(id(
    "key")), $dispatch(id("key"), getPersistentValue) ; $lock(id("res"),
    getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal("set"))]))))]))})))) |
    getStack(addArgs(args(empty), params(empty), assignVar("payload", getValue(
    {dictVal(getDict(getValue(evalExpr(dict(dictItem(id("value"), call("len",
    args(id("response"))))),[func("addFavorite", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), call("request", args(str("db"), str(
    "insert-favorite"), dict(dictItem(id("type"), str("guest")), dictItem(id(
    "guest_id"), member(id("user"), "session"))))) ; assign(id("response"),
    call("request", args(str("db"), str("get-favorites"), dict(dictItem(id(
    "type"), str("guest")), dictItem(id("field"), str("guest_id")), dictItem(
    id("value"), member(id("user"), "session")))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:guest:"),
    member(id("user"), "session"))), dictItem(id("value"), call("len", args(id(
    "response"))))))), $ifelse($eq(member(id("user"), "type"), str("user")),
    call("request", args(str("db"), str("insert-favorite"), dict(dictItem(id(
    "type"), str("user")), dictItem(id("user_id"), member(id("user"), "id")))))
    ; assign(id("response"), call("request", args(str("db"), str(
    "get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | pushStack(getValue(evalExpr($add(str(
    "fav:user:"), member(id("user"), "id")),[func("addFavorite", params(id(
    "request")), assign(id("user"), member(id("request"), "user")) ; $ifelse(
    $eq(member(id("user"), "type"), str("guest")), call("request", args(str(
    "db"), str("insert-favorite"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("guest_id"), member(id("user"), "session"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("field"), str("guest_id")),
    dictItem(id("value"), member(id("user"), "session")))))) ; call("request",
    args(str("cache"), str("set"), dict(dictItem(id("key"), $add(str(
    "fav:guest:"), member(id("user"), "session"))), dictItem(id("value"), call(
    "len", args(id("response"))))))), $ifelse($eq(member(id("user"), "type"),
    str("user")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("user")), dictItem(id("user_id"), member(id(
    "user"), "id"))))) ; assign(id("response"), call("request", args(str("db"),
    str("get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal("set"))])), getStack(
    getState(evalExpr($add(str("fav:user:"), member(id("user"), "id")),[func(
    "addFavorite", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("guest_id"), member(id(
    "user"), "session"))))) ; assign(id("response"), call("request", args(str(
    "db"), str("get-favorites"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("field"), str("guest_id")), dictItem(id("value"), member(id(
    "user"), "session")))))) ; call("request", args(str("cache"), str("set"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))), dictItem(id("value"), call("len", args(id("response"))))))),
    $ifelse($eq(member(id("user"), "type"), str("user")), call("request", args(
    str("db"), str("insert-favorite"), dict(dictItem(id("type"), str("user")),
    dictItem(id("user_id"), member(id("user"), "id"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("user")), dictItem(id("field"), str("user_id")),
    dictItem(id("value"), member(id("user"), "id")))))) ; call("request", args(
    str("cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))), dictItem(id("value"), call("len", args(id(
    "response"))))))), pass)) ; call("respond", args(str("ok")))) ; func(
    "getFavoriteCount", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), assign(id("r"), call("request", args(str("cache"), str("get"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(member(id(
    "user"), "type"), str("user")), assign(id("r"), call("request", args(str(
    "cache"), str("get"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))))))) ; call("respond", args(id("r"))), pass)) ;
    call("respond", args(str("ok")))) ; func("getPersistent", params(id(
    "key")), $dispatch(id("key"), getPersistentValue) ; $lock(id("res"),
    getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal("set"))]))))]))) ; d(
    "key", lastIndex(getStack(getState(evalExpr($add(str("fav:user:"), member(
    id("user"), "id")),[func("addFavorite", params(id("request")), assign(id(
    "user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), call("request", args(str("db"), str(
    "insert-favorite"), dict(dictItem(id("type"), str("guest")), dictItem(id(
    "guest_id"), member(id("user"), "session"))))) ; assign(id("response"),
    call("request", args(str("db"), str("get-favorites"), dict(dictItem(id(
    "type"), str("guest")), dictItem(id("field"), str("guest_id")), dictItem(
    id("value"), member(id("user"), "session")))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:guest:"),
    member(id("user"), "session"))), dictItem(id("value"), call("len", args(id(
    "response"))))))), $ifelse($eq(member(id("user"), "type"), str("user")),
    call("request", args(str("db"), str("insert-favorite"), dict(dictItem(id(
    "type"), str("user")), dictItem(id("user_id"), member(id("user"), "id")))))
    ; assign(id("response"), call("request", args(str("db"), str(
    "get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal("set"))])))))),
    getState(evalExpr(dict(dictItem(id("value"), call("len", args(id(
    "response"))))),[func("addFavorite", params(id("request")), assign(id(
    "user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), call("request", args(str("db"), str(
    "insert-favorite"), dict(dictItem(id("type"), str("guest")), dictItem(id(
    "guest_id"), member(id("user"), "session"))))) ; assign(id("response"),
    call("request", args(str("db"), str("get-favorites"), dict(dictItem(id(
    "type"), str("guest")), dictItem(id("field"), str("guest_id")), dictItem(
    id("value"), member(id("user"), "session")))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:guest:"),
    member(id("user"), "session"))), dictItem(id("value"), call("len", args(id(
    "response"))))))), $ifelse($eq(member(id("user"), "type"), str("user")),
    call("request", args(str("db"), str("insert-favorite"), dict(dictItem(id(
    "type"), str("user")), dictItem(id("user_id"), member(id("user"), "id")))))
    ; assign(id("response"), call("request", args(str("db"), str(
    "get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | pushStack(getValue(evalExpr($add(str(
    "fav:user:"), member(id("user"), "id")),[func("addFavorite", params(id(
    "request")), assign(id("user"), member(id("request"), "user")) ; $ifelse(
    $eq(member(id("user"), "type"), str("guest")), call("request", args(str(
    "db"), str("insert-favorite"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("guest_id"), member(id("user"), "session"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("field"), str("guest_id")),
    dictItem(id("value"), member(id("user"), "session")))))) ; call("request",
    args(str("cache"), str("set"), dict(dictItem(id("key"), $add(str(
    "fav:guest:"), member(id("user"), "session"))), dictItem(id("value"), call(
    "len", args(id("response"))))))), $ifelse($eq(member(id("user"), "type"),
    str("user")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("user")), dictItem(id("user_id"), member(id(
    "user"), "id"))))) ; assign(id("response"), call("request", args(str("db"),
    str("get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal("set"))])), getStack(
    getState(evalExpr($add(str("fav:user:"), member(id("user"), "id")),[func(
    "addFavorite", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("guest_id"), member(id(
    "user"), "session"))))) ; assign(id("response"), call("request", args(str(
    "db"), str("get-favorites"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("field"), str("guest_id")), dictItem(id("value"), member(id(
    "user"), "session")))))) ; call("request", args(str("cache"), str("set"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))), dictItem(id("value"), call("len", args(id("response"))))))),
    $ifelse($eq(member(id("user"), "type"), str("user")), call("request", args(
    str("db"), str("insert-favorite"), dict(dictItem(id("type"), str("user")),
    dictItem(id("user_id"), member(id("user"), "id"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("user")), dictItem(id("field"), str("user_id")),
    dictItem(id("value"), member(id("user"), "id")))))) ; call("request", args(
    str("cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))), dictItem(id("value"), call("len", args(id(
    "response"))))))), pass)) ; call("respond", args(str("ok")))) ; func(
    "getFavoriteCount", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), assign(id("r"), call("request", args(str("cache"), str("get"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(member(id(
    "user"), "type"), str("user")), assign(id("r"), call("request", args(str(
    "cache"), str("get"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))))))) ; call("respond", args(id("r"))), pass)) ;
    call("respond", args(str("ok")))) ; func("getPersistent", params(id(
    "key")), $dispatch(id("key"), getPersistentValue) ; $lock(id("res"),
    getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal("set"))]))))]))}),
    getState({dictVal(getDict(getValue(evalExpr(dict(dictItem(id("value"),
    call("len", args(id("response"))))),[func("addFavorite", params(id(
    "request")), assign(id("user"), member(id("request"), "user")) ; $ifelse(
    $eq(member(id("user"), "type"), str("guest")), call("request", args(str(
    "db"), str("insert-favorite"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("guest_id"), member(id("user"), "session"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("field"), str("guest_id")),
    dictItem(id("value"), member(id("user"), "session")))))) ; call("request",
    args(str("cache"), str("set"), dict(dictItem(id("key"), $add(str(
    "fav:guest:"), member(id("user"), "session"))), dictItem(id("value"), call(
    "len", args(id("response"))))))), $ifelse($eq(member(id("user"), "type"),
    str("user")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("user")), dictItem(id("user_id"), member(id(
    "user"), "id"))))) ; assign(id("response"), call("request", args(str("db"),
    str("get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | pushStack(getValue(evalExpr($add(str(
    "fav:user:"), member(id("user"), "id")),[func("addFavorite", params(id(
    "request")), assign(id("user"), member(id("request"), "user")) ; $ifelse(
    $eq(member(id("user"), "type"), str("guest")), call("request", args(str(
    "db"), str("insert-favorite"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("guest_id"), member(id("user"), "session"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("field"), str("guest_id")),
    dictItem(id("value"), member(id("user"), "session")))))) ; call("request",
    args(str("cache"), str("set"), dict(dictItem(id("key"), $add(str(
    "fav:guest:"), member(id("user"), "session"))), dictItem(id("value"), call(
    "len", args(id("response"))))))), $ifelse($eq(member(id("user"), "type"),
    str("user")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("user")), dictItem(id("user_id"), member(id(
    "user"), "id"))))) ; assign(id("response"), call("request", args(str("db"),
    str("get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal("set"))])), getStack(
    getState(evalExpr($add(str("fav:user:"), member(id("user"), "id")),[func(
    "addFavorite", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("guest_id"), member(id(
    "user"), "session"))))) ; assign(id("response"), call("request", args(str(
    "db"), str("get-favorites"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("field"), str("guest_id")), dictItem(id("value"), member(id(
    "user"), "session")))))) ; call("request", args(str("cache"), str("set"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))), dictItem(id("value"), call("len", args(id("response"))))))),
    $ifelse($eq(member(id("user"), "type"), str("user")), call("request", args(
    str("db"), str("insert-favorite"), dict(dictItem(id("type"), str("user")),
    dictItem(id("user_id"), member(id("user"), "id"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("user")), dictItem(id("field"), str("user_id")),
    dictItem(id("value"), member(id("user"), "id")))))) ; call("request", args(
    str("cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))), dictItem(id("value"), call("len", args(id(
    "response"))))))), pass)) ; call("respond", args(str("ok")))) ; func(
    "getFavoriteCount", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), assign(id("r"), call("request", args(str("cache"), str("get"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(member(id(
    "user"), "type"), str("user")), assign(id("r"), call("request", args(str(
    "cache"), str("get"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))))))) ; call("respond", args(id("r"))), pass)) ;
    call("respond", args(str("ok")))) ; func("getPersistent", params(id(
    "key")), $dispatch(id("key"), getPersistentValue) ; $lock(id("res"),
    getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal("set"))]))))]))) ; d(
    "key", lastIndex(getStack(getState(evalExpr($add(str("fav:user:"), member(
    id("user"), "id")),[func("addFavorite", params(id("request")), assign(id(
    "user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), call("request", args(str("db"), str(
    "insert-favorite"), dict(dictItem(id("type"), str("guest")), dictItem(id(
    "guest_id"), member(id("user"), "session"))))) ; assign(id("response"),
    call("request", args(str("db"), str("get-favorites"), dict(dictItem(id(
    "type"), str("guest")), dictItem(id("field"), str("guest_id")), dictItem(
    id("value"), member(id("user"), "session")))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:guest:"),
    member(id("user"), "session"))), dictItem(id("value"), call("len", args(id(
    "response"))))))), $ifelse($eq(member(id("user"), "type"), str("user")),
    call("request", args(str("db"), str("insert-favorite"), dict(dictItem(id(
    "type"), str("user")), dictItem(id("user_id"), member(id("user"), "id")))))
    ; assign(id("response"), call("request", args(str("db"), str(
    "get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal("set"))])))))),
    getState(evalExpr(dict(dictItem(id("value"), call("len", args(id(
    "response"))))),[func("addFavorite", params(id("request")), assign(id(
    "user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), call("request", args(str("db"), str(
    "insert-favorite"), dict(dictItem(id("type"), str("guest")), dictItem(id(
    "guest_id"), member(id("user"), "session"))))) ; assign(id("response"),
    call("request", args(str("db"), str("get-favorites"), dict(dictItem(id(
    "type"), str("guest")), dictItem(id("field"), str("guest_id")), dictItem(
    id("value"), member(id("user"), "session")))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:guest:"),
    member(id("user"), "session"))), dictItem(id("value"), call("len", args(id(
    "response"))))))), $ifelse($eq(member(id("user"), "type"), str("user")),
    call("request", args(str("db"), str("insert-favorite"), dict(dictItem(id(
    "type"), str("user")), dictItem(id("user_id"), member(id("user"), "id")))))
    ; assign(id("response"), call("request", args(str("db"), str(
    "get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | pushStack(getValue(evalExpr($add(str(
    "fav:user:"), member(id("user"), "id")),[func("addFavorite", params(id(
    "request")), assign(id("user"), member(id("request"), "user")) ; $ifelse(
    $eq(member(id("user"), "type"), str("guest")), call("request", args(str(
    "db"), str("insert-favorite"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("guest_id"), member(id("user"), "session"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("field"), str("guest_id")),
    dictItem(id("value"), member(id("user"), "session")))))) ; call("request",
    args(str("cache"), str("set"), dict(dictItem(id("key"), $add(str(
    "fav:guest:"), member(id("user"), "session"))), dictItem(id("value"), call(
    "len", args(id("response"))))))), $ifelse($eq(member(id("user"), "type"),
    str("user")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("user")), dictItem(id("user_id"), member(id(
    "user"), "id"))))) ; assign(id("response"), call("request", args(str("db"),
    str("get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal("set"))])), getStack(
    getState(evalExpr($add(str("fav:user:"), member(id("user"), "id")),[func(
    "addFavorite", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("guest_id"), member(id(
    "user"), "session"))))) ; assign(id("response"), call("request", args(str(
    "db"), str("get-favorites"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("field"), str("guest_id")), dictItem(id("value"), member(id(
    "user"), "session")))))) ; call("request", args(str("cache"), str("set"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))), dictItem(id("value"), call("len", args(id("response"))))))),
    $ifelse($eq(member(id("user"), "type"), str("user")), call("request", args(
    str("db"), str("insert-favorite"), dict(dictItem(id("type"), str("user")),
    dictItem(id("user_id"), member(id("user"), "id"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("user")), dictItem(id("field"), str("user_id")),
    dictItem(id("value"), member(id("user"), "id")))))) ; call("request", args(
    str("cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))), dictItem(id("value"), call("len", args(id(
    "response"))))))), pass)) ; call("respond", args(str("ok")))) ; func(
    "getFavoriteCount", params(id("request")), assign(id("user"), member(id(
    "request"), "user")) ; $ifelse($eq(member(id("user"), "type"), str(
    "guest")), assign(id("r"), call("request", args(str("cache"), str("get"),
    dict(dictItem(id("key"), $add(str("fav:guest:"), member(id("user"),
    "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(member(id(
    "user"), "type"), str("user")), assign(id("r"), call("request", args(str(
    "cache"), str("get"), dict(dictItem(id("key"), $add(str("fav:user:"),
    member(id("user"), "id"))))))) ; call("respond", args(id("r"))), pass)) ;
    call("respond", args(str("ok")))) ; func("getPersistent", params(id(
    "key")), $dispatch(id("key"), getPersistentValue) ; $lock(id("res"),
    getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | "path" := 39 ; "request" := 3 ; "response" := 37 ;
    "svc" := 38 ; "user" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)) ; 3 |-> dictVal(d(
    "user", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal("user") ; 6 |-> dictVal(d(
    "id", 4) ; d("type", 5)) ; 7 |-> strVal("db") ; 8 |-> strVal(
    "insert-favorite") ; 9 |-> strVal("user") ; 10 |-> intVal(0) ; 11 |->
    dictVal(d("type", 9) ; d("user_id", 10)) ; 12 |-> strVal("db") ; 13 |->
    strVal("insert-favorite") ; 14 |-> strVal("user") ; 15 |-> intVal(0) ; 16
    |-> dictVal(d("type", 14) ; d("user_id", 15)) ; 17 |-> strVal("ok") ; 18
    |-> strVal("db") ; 19 |-> strVal("get-favorites") ; 20 |-> strVal("user") ;
    21 |-> strVal("user_id") ; 22 |-> intVal(0) ; 23 |-> dictVal(d("field", 21)
    ; d("type", 20) ; d("value", 22)) ; 24 |-> strVal("db") ; 25 |-> strVal(
    "get-favorites") ; 26 |-> strVal("user_id") ; 27 |-> strVal("user") ; 28
    |-> intVal(0) ; 29 |-> dictVal(d("field", 26) ; d("type", 27) ; d("value",
    28)) ; 30 |-> listVal(33) ; 31 |-> strVal("user") ; 32 |-> intVal(0) ; 33
    |-> dictVal(d("type", 31) ; d("user_id", 32)) ; 34 |-> strVal("user") ; 35
    |-> intVal(0) ; 36 |-> dictVal(d("type", 34) ; d("user_id", 35)) ; 37 |->
    listVal(36) ; 38 |-> strVal("cache") ; 39 |-> strVal(
    "set"))]))))]))}))))])))), initialState :([func("addFavorite", params(id(
    "request")), assign(id("user"), member(id("request"), "user")) ; $ifelse(
    $eq(member(id("user"), "type"), str("guest")), call("request", args(str(
    "db"), str("insert-favorite"), dict(dictItem(id("type"), str("guest")),
    dictItem(id("guest_id"), member(id("user"), "session"))))) ; assign(id(
    "response"), call("request", args(str("db"), str("get-favorites"), dict(
    dictItem(id("type"), str("guest")), dictItem(id("field"), str("guest_id")),
    dictItem(id("value"), member(id("user"), "session")))))) ; call("request",
    args(str("cache"), str("set"), dict(dictItem(id("key"), $add(str(
    "fav:guest:"), member(id("user"), "session"))), dictItem(id("value"), call(
    "len", args(id("response"))))))), $ifelse($eq(member(id("user"), "type"),
    str("user")), call("request", args(str("db"), str("insert-favorite"), dict(
    dictItem(id("type"), str("user")), dictItem(id("user_id"), member(id(
    "user"), "id"))))) ; assign(id("response"), call("request", args(str("db"),
    str("get-favorites"), dict(dictItem(id("type"), str("user")), dictItem(id(
    "field"), str("user_id")), dictItem(id("value"), member(id("user"),
    "id")))))) ; call("request", args(str("cache"), str("set"), dict(dictItem(
    id("key"), $add(str("fav:user:"), member(id("user"), "id"))), dictItem(id(
    "value"), call("len", args(id("response"))))))), pass)) ; call("respond",
    args(str("ok")))) ; func("getFavoriteCount", params(id("request")), assign(
    id("user"), member(id("request"), "user")) ; $ifelse($eq(member(id("user"),
    "type"), str("guest")), assign(id("r"), call("request", args(str("cache"),
    str("get"), dict(dictItem(id("key"), $add(str("fav:guest:"), member(id(
    "user"), "session"))))))) ; call("respond", args(id("r"))), $ifelse($eq(
    member(id("user"), "type"), str("user")), assign(id("r"), call("request",
    args(str("cache"), str("get"), dict(dictItem(id("key"), $add(str(
    "fav:user:"), member(id("user"), "id"))))))) ; call("respond", args(id(
    "r"))), pass)) ; call("respond", args(str("ok")))) ; func("getPersistent",
    params(id("key")), $dispatch(id("key"), getPersistentValue) ; $lock(id(
    "res"), getPersistentValue) ; return(id("res"))) ; func("login", params(id(
    "request")), assign(id("guest"), member(id("request"), "user")) ; assign(
    id("user_id"), member(id("request"), "user_id")) ; assign(id("fav"), call(
    "request", args(str("db"), str("get-favorites"), dict(dictItem(id("type"),
    str("guest")), dictItem(id("field"), str("guest_id")), dictItem(id(
    "value"), member(id("guest"), "session")))))) ; assign(id("userCount"),
    call("request", args(str("cache"), str("get"), dict(dictItem(id("key"),
    $add(str("fav:user:"), id("user_id"))))))) ; call("request", args(str(
    "cache"), str("set"), dict(dictItem(id("key"), $add(str("fav:user:"), id(
    "user_id"))), dictItem(id("value"), $add(id("userCount"), call("len", args(
    id("fav"))))))))) ; func("request", params(id("svc"), id("path"), id(
    "payload")), $dispatch(list(id("svc"), id("path"), id("payload")),
    connectionOut) ; $lock(id("res"), connectionOut) ; return(id("res"))) ;
    func("respond", params(id("value")), $dispatch(id("value"), connectionIn))
    ; func("setPersistent", params(id("key"), id("value")), $dispatch(list(id(
    "key"), id("value")), setPersistentValue) ; $lock(id("res"),
    setPersistentValue)) | empty | stack(3, 0 |-> intVal(0) ; 1 |-> strVal(
    "user") ; 2 |-> dictVal(d("id", 0) ; d("type", 1)))]), waiting : none > ]

}
service "cache" {
	code {...}
	routes {...}
	persistent("keys", map("fav:guest:session-0" |-> intVal(1)))

}
service "db" {
	code {...}
	routes {...}
	persistent("favorites", list(map(("guest_id" |-> strVal("session-0"),
    "type" |-> strVal("guest"))) map(("type" |-> strVal("user"), "user_id" |->
    intVal(0)))))

}
service initId(0) {
	process for init : [ waiting connection 5 ]
}
service initId(1) {
	process for init : [ ended execution ]
}
rewrites: 70322 in 590ms cpu (587ms real) (119189 rewrites/second)
result Configuration: debug("<>\nconnectionManager(8)\ninitManager(2)\nservice \"backend\" {\n\tcode {...}\n\troutes {...}\n\tprocess for CONN : 5 | \"/add-favorite\" ~ map(\"user\" |-> map((\"id\" |-> intVal(0), \"type\" |-> strVal(\"user\")))) : [ \t\t< executor : Executor | currentResult : evalStmt(call(\"respond\", args(str(\"ok\"))), getState(functionCallResult(params(id(\"svc\"), id(\"path\"), id(\"payload\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"request\" := 3 ; \"response\" := 37 ; \"user\" := 6 | stack(38, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36))], evalStmt($dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | getVars(addArgs(args(empty), params(empty), assignVar(\"payload\", getValue({dictVal(getDict(getValue(evalExpr(dict(dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | pushStack(getValue(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))])), getStack(getState(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))]))))]))) ; d(\"key\", lastIndex(getStack(getState(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))])))))), getState(evalExpr(dict(dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | pushStack(getValue(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))])), getStack(getState(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))]))))]))}), getState({dictVal(getDict(getValue(evalExpr(dict(dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | pushStack(getValue(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))])), getStack(getState(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))]))))]))) ; d(\"key\", lastIndex(getStack(getState(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))])))))), getState(evalExpr(dict(dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | pushStack(getValue(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))])), getStack(getState(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))]))))]))})))) | getStack(addArgs(args(empty), params(empty), assignVar(\"payload\", getValue({dictVal(getDict(getValue(evalExpr(dict(dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | pushStack(getValue(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))])), getStack(getState(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))]))))]))) ; d(\"key\", lastIndex(getStack(getState(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))])))))), getState(evalExpr(dict(dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | pushStack(getValue(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))])), getStack(getState(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))]))))]))}), getState({dictVal(getDict(getValue(evalExpr(dict(dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | pushStack(getValue(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))])), getStack(getState(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))]))))]))) ; d(\"key\", lastIndex(getStack(getState(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))])))))), getState(evalExpr(dict(dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | pushStack(getValue(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))])), getStack(getState(evalExpr($add(str(\"fav:user:\"), member(id(\"user\"), \"id\")),[func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | \"path\" := 39 ; \"request\" := 3 ; \"response\" := 37 ; \"svc\" := 38 ; \"user\" := 6 | stack(40, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)) ; 3 |-> dictVal(d(\"user\", 2)) ; 4 |-> intVal(0) ; 5 |-> strVal(\"user\") ; 6 |-> dictVal(d(\"id\", 4) ; d(\"type\", 5)) ; 7 |-> strVal(\"db\") ; 8 |-> strVal(\"insert-favorite\") ; 9 |-> strVal(\"user\") ; 10 |-> intVal(0) ; 11 |-> dictVal(d(\"type\", 9) ; d(\"user_id\", 10)) ; 12 |-> strVal(\"db\") ; 13 |-> strVal(\"insert-favorite\") ; 14 |-> strVal(\"user\") ; 15 |-> intVal(0) ; 16 |-> dictVal(d(\"type\", 14) ; d(\"user_id\", 15)) ; 17 |-> strVal(\"ok\") ; 18 |-> strVal(\"db\") ; 19 |-> strVal(\"get-favorites\") ; 20 |-> strVal(\"user\") ; 21 |-> strVal(\"user_id\") ; 22 |-> intVal(0) ; 23 |-> dictVal(d(\"field\", 21) ; d(\"type\", 20) ; d(\"value\", 22)) ; 24 |-> strVal(\"db\") ; 25 |-> strVal(\"get-favorites\") ; 26 |-> strVal(\"user_id\") ; 27 |-> strVal(\"user\") ; 28 |-> intVal(0) ; 29 |-> dictVal(d(\"field\", 26) ; d(\"type\", 27) ; d(\"value\", 28)) ; 30 |-> listVal(33) ; 31 |-> strVal(\"user\") ; 32 |-> intVal(0) ; 33 |-> dictVal(d(\"type\", 31) ; d(\"user_id\", 32)) ; 34 |-> strVal(\"user\") ; 35 |-> intVal(0) ; 36 |-> dictVal(d(\"type\", 34) ; d(\"user_id\", 35)) ; 37 |-> listVal(36) ; 38 |-> strVal(\"cache\") ; 39 |-> strVal(\"set\"))]))))]))}))))])))), initialState :([func(\"addFavorite\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"guest_id\"), member(id(\"user\"), \"session\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"session\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), call(\"request\", args(str(\"db\"), str(\"insert-favorite\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"user_id\"), member(id(\"user\"), \"id\"))))) ; assign(id(\"response\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"user\")), dictItem(id(\"field\"), str(\"user_id\")), dictItem(id(\"value\"), member(id(\"user\"), \"id\")))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))), dictItem(id(\"value\"), call(\"len\", args(id(\"response\"))))))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getFavoriteCount\", params(id(\"request\")), assign(id(\"user\"), member(id(\"request\"), \"user\")) ; $ifelse($eq(member(id(\"user\"), \"type\"), str(\"guest\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:guest:\"), member(id(\"user\"), \"session\"))))))) ; call(\"respond\", args(id(\"r\"))), $ifelse($eq(member(id(\"user\"), \"type\"), str(\"user\")), assign(id(\"r\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), member(id(\"user\"), \"id\"))))))) ; call(\"respond\", args(id(\"r\"))), pass)) ; call(\"respond\", args(str(\"ok\")))) ; func(\"getPersistent\", params(id(\"key\")), $dispatch(id(\"key\"), getPersistentValue) ; $lock(id(\"res\"), getPersistentValue) ; return(id(\"res\"))) ; func(\"login\", params(id(\"request\")), assign(id(\"guest\"), member(id(\"request\"), \"user\")) ; assign(id(\"user_id\"), member(id(\"request\"), \"user_id\")) ; assign(id(\"fav\"), call(\"request\", args(str(\"db\"), str(\"get-favorites\"), dict(dictItem(id(\"type\"), str(\"guest\")), dictItem(id(\"field\"), str(\"guest_id\")), dictItem(id(\"value\"), member(id(\"guest\"), \"session\")))))) ; assign(id(\"userCount\"), call(\"request\", args(str(\"cache\"), str(\"get\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))))))) ; call(\"request\", args(str(\"cache\"), str(\"set\"), dict(dictItem(id(\"key\"), $add(str(\"fav:user:\"), id(\"user_id\"))), dictItem(id(\"value\"), $add(id(\"userCount\"), call(\"len\", args(id(\"fav\"))))))))) ; func(\"request\", params(id(\"svc\"), id(\"path\"), id(\"payload\")), $dispatch(list(id(\"svc\"), id(\"path\"), id(\"payload\")), connectionOut) ; $lock(id(\"res\"), connectionOut) ; return(id(\"res\"))) ; func(\"respond\", params(id(\"value\")), $dispatch(id(\"value\"), connectionIn)) ; func(\"setPersistent\", params(id(\"key\"), id(\"value\")), $dispatch(list(id(\"key\"), id(\"value\")), setPersistentValue) ; $lock(id(\"res\"), setPersistentValue)) | empty | stack(3, 0 |-> intVal(0) ; 1 |-> strVal(\"user\") ; 2 |-> dictVal(d(\"id\", 0) ; d(\"type\", 1)))]), waiting : none > ]\n\n}\nservice \"cache\" {\n\tcode {...}\n\troutes {...}\n\tpersistent(\"keys\", map(\"fav:guest:session-0\" |-> intVal(1)))\n\n}\nservice \"db\" {\n\tcode {...}\n\troutes {...}\n\tpersistent(\"favorites\", list(map((\"guest_id\" |-> strVal(\"session-0\"), \"type\" |-> strVal(\"guest\"))) map((\"type\" |-> strVal(\"user\"), \"user_id\" |-> intVal(0)))))\n\n}\nservice initId(0) {\n\tprocess for init : [ waiting connection 5 ]\n}\nservice initId(1) {\n\tprocess for init : [ ended execution ]\n}\n")
    parsedTermFromString(composition, composition) simulatedAndPrinted(
    composition, composition) < composition : Composition | metaTerm : ('__[
    '<>.Portal,'connectionManager['0.Zero],'initManager['0.Zero],'init['_;_[
    'assign['id['"user".String],'dict['_`,_['dictItem['id['"type".String],'str[
    '"guest".String]],'dictItem['id['"session".String],'str[
    '"session-0".String]]]]],'call['"request".String,'args['_`,_['str[
    '"backend".String],'str['"/add-favorite".String],'dict['dictItem['id[
    '"user".String],'id['"user".String]]]]]],'call['"request".String,'args[
    '_`,_['str['"backend".String],'str['"/add-favorite".String],'dict[
    'dictItem['id['"user".String],'dict['_`,_['dictItem['id['"type".String],
    'str['"user".String]],'dictItem['id['"id".String],'int['0.Zero]]]]]]]]],
    'call['"request".String,'args['_`,_['str['"backend".String],'str[
    '"/login".String],'dict['_`,_['dictItem['id['"user".String],'id[
    '"user".String]],'dictItem['id['"user_id".String],'int['0.Zero]]]]]]],
    'call['"request".String,'args['_`,_['str['"backend".String],'str[
    '"favorite-count".String],'dict['dictItem['id['"user".String],'id[
    '"user".String]]]]]]]],'init['call['"request".String,'args['_`,_['str[
    '"cache".String],'str['"flush".String],'dict[
    'emptyDict.DictEntryListAST]]]]],'service['"backend".String,'server['_`,_[
    'code['_;_['function['"addFavorite".String,'params['id['"request".String]],
    '_;_['assign['id['"user".String],'member['id['"request".String],
    '"user".String]],'$ifelse['$eq['member['id['"user".String],'"type".String],
    'str['"guest".String]],'_;_['call['"request".String,'args['_`,_['str[
    '"db".String],'str['"insert-favorite".String],'dict['_`,_['dictItem['id[
    '"type".String],'str['"guest".String]],'dictItem['id['"guest_id".String],
    'member['id['"user".String],'"session".String]]]]]]],'assign['id[
    '"response".String],'call['"request".String,'args['_`,_['str['"db".String],
    'str['"get-favorites".String],'dict['_`,_['dictItem['id['"type".String],
    'str['"guest".String]],'dictItem['id['"field".String],'str[
    '"guest_id".String]],'dictItem['id['"value".String],'member['id[
    '"user".String],'"session".String]]]]]]]],'call['"request".String,'args[
    '_`,_['str['"cache".String],'str['"set".String],'dict['_`,_['dictItem['id[
    '"key".String],'$add['str['"fav:guest:".String],'member['id[
    '"user".String],'"session".String]]],'dictItem['id['"value".String],'call[
    '"len".String,'args['id['"response".String]]]]]]]]]],'$ifelse['$eq['member[
    'id['"user".String],'"type".String],'str['"user".String]],'_;_['call[
    '"request".String,'args['_`,_['str['"db".String],'str[
    '"insert-favorite".String],'dict['_`,_['dictItem['id['"type".String],'str[
    '"user".String]],'dictItem['id['"user_id".String],'member['id[
    '"user".String],'"id".String]]]]]]],'assign['id['"response".String],'call[
    '"request".String,'args['_`,_['str['"db".String],'str[
    '"get-favorites".String],'dict['_`,_['dictItem['id['"type".String],'str[
    '"user".String]],'dictItem['id['"field".String],'str['"user_id".String]],
    'dictItem['id['"value".String],'member['id['"user".String],
    '"id".String]]]]]]]],'call['"request".String,'args['_`,_['str[
    '"cache".String],'str['"set".String],'dict['_`,_['dictItem['id[
    '"key".String],'$add['str['"fav:user:".String],'member['id['"user".String],
    '"id".String]]],'dictItem['id['"value".String],'call['"len".String,'args[
    'id['"response".String]]]]]]]]]],'pass.StmtAST]],'call['"respond".String,
    'args['str['"ok".String]]]]],'function['"getFavoriteCount".String,'params[
    'id['"request".String]],'_;_['assign['id['"user".String],'member['id[
    '"request".String],'"user".String]],'$ifelse['$eq['member['id[
    '"user".String],'"type".String],'str['"guest".String]],'_;_['assign['id[
    '"r".Char],'call['"request".String,'args['_`,_['str['"cache".String],'str[
    '"get".String],'dict['dictItem['id['"key".String],'$add['str[
    '"fav:guest:".String],'member['id['"user".String],
    '"session".String]]]]]]]],'call['"respond".String,'args['id['"r".Char]]]],
    '$ifelse['$eq['member['id['"user".String],'"type".String],'str[
    '"user".String]],'_;_['assign['id['"r".Char],'call['"request".String,'args[
    '_`,_['str['"cache".String],'str['"get".String],'dict['dictItem['id[
    '"key".String],'$add['str['"fav:user:".String],'member['id['"user".String],
    '"id".String]]]]]]]],'call['"respond".String,'args['id['"r".Char]]]],
    'pass.StmtAST]],'call['"respond".String,'args['str['"ok".String]]]]],
    'function['"login".String,'params['id['"request".String]],'_;_['assign['id[
    '"guest".String],'member['id['"request".String],'"user".String]],'assign[
    'id['"user_id".String],'member['id['"request".String],'"user_id".String]],
    'assign['id['"fav".String],'call['"request".String,'args['_`,_['str[
    '"db".String],'str['"get-favorites".String],'dict['_`,_['dictItem['id[
    '"type".String],'str['"guest".String]],'dictItem['id['"field".String],'str[
    '"guest_id".String]],'dictItem['id['"value".String],'member['id[
    '"guest".String],'"session".String]]]]]]]],'assign['id[
    '"userCount".String],'call['"request".String,'args['_`,_['str[
    '"cache".String],'str['"get".String],'dict['dictItem['id['"key".String],
    '$add['str['"fav:user:".String],'id['"user_id".String]]]]]]]],'call[
    '"request".String,'args['_`,_['str['"cache".String],'str['"set".String],
    'dict['_`,_['dictItem['id['"key".String],'$add['str['"fav:user:".String],
    'id['"user_id".String]]],'dictItem['id['"value".String],'$add['id[
    '"userCount".String],'call['"len".String,'args['id[
    '"fav".String]]]]]]]]]]]]]],'routes['_`,_['route['"/add-favorite".String,
    '"addFavorite".String],'route['"/favorite-count".String,
    '"getFavoriteCount".String],'route['"/login".String,'"login".String]]]]]],
    'service['"cache".String,'server['_`,_['code['_;_['function['"set".String,
    'params['id['"request".String]],'_;_['assign['id['"k".Char],'call[
    '"getPersistent".String,'args['str['"keys".String]]]],'assign['index['id[
    '"k".Char],'member['id['"request".String],'"key".String]],'member['id[
    '"request".String],'"value".String]],'call['"setPersistent".String,'args[
    '_`,_['str['"keys".String],'id['"k".Char]]]],'call['"respond".String,'args[
    'str['"ok".String]]]]],'function['"get".String,'params['id[
    '"request".String]],'_;_['assign['id['"k".Char],'call[
    '"getPersistent".String,'args['str['"keys".String]]]],'call[
    '"respond".String,'args['index['id['"k".Char],'member['id[
    '"request".String],'"key".String]]]]]],'function['"flush".String,'params[
    'id['"request".String]],'_;_['call['"setPersistent".String,'args['_`,_[
    'str['"keys".String],'dict['emptyDict.DictEntryListAST]]]],'call[
    '"respond".String,'args['str['"ok".String]]]]]]],'routes['_`,_['route[
    '"flush".String,'"flush".String],'route['"get".String,'"get".String],
    'route['"set".String,'"set".String]]],'persistent['"keys".String,'map[
    'empty.Map`{String`,IOValue`}]]]]],'service['"db".String,'server['_`,_[
    'code['_;_['function['"insertFavorite".String,'params['id[
    '"request".String]],'_;_['assign['id['"fav".String],'call[
    '"getPersistent".String,'args['str['"favorites".String]]]],'call[
    '"setPersistent".String,'args['_`,_['str['"favorites".String],'call[
    '"append".String,'args['_`,_['id['"fav".String],'id[
    '"request".String]]]]]]],'call['"respond".String,'args['str[
    '"ok".String]]]]],'function['"getFavorites".String,'params['id[
    '"query".String]],'_;_['assign['id['"fav".String],'call[
    '"getPersistent".String,'args['str['"favorites".String]]]],'assign['id[
    '"i".Char],'int['0.Zero]],'assign['id['"resp".String],'list[
    'empty.ParamListAST]],'$while['$lt['id['"i".Char],'call['"len".String,
    'args['id['"fav".String]]]],'_;_['$ifelse['$and['$eq['member['index['id[
    '"fav".String],'id['"i".Char]],'"type".String],'member['id[
    '"query".String],'"type".String]],'$eq['index['index['id['"fav".String],
    'id['"i".Char]],'member['id['"query".String],'"field".String]],'member['id[
    '"query".String],'"value".String]]],'assign['id['"resp".String],'call[
    '"append".String,'args['_`,_['id['"resp".String],'index['id['"fav".String],
    'id['"i".Char]]]]]],'pass.StmtAST],'assign['id['"i".Char],'$add['id[
    '"i".Char],'int['s_['0.Zero]]]]]],'call['"respond".String,'args['id[
    '"resp".String]]]]]]],'routes['_`,_['route['"get-favorites".String,
    '"getFavorites".String],'route['"insert-favorite".String,
    '"insertFavorite".String]]],'persistent['"favorites".String,'list[
    'nil.List`{IOValue`}]]]]]]) >
Bye.
